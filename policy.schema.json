{
    "$id": "https://raw.githubusercontent.com/leaksignal/leaksignal/master/policy.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "type": "object",
    "$defs": {
        "hash_type": {
            "enum": [
                "bcrypt",
                "sha256_crypt",
                "sha512_crypt",
                "md5_crypt",
                "sha1_crypt",
                "sun_md5_crypt",
                "argon2",
                "bcrypt_sha256",
                "phpass",
                "pbkdf2_sha1",
                "pbkdf2_sha256",
                "pbkdf2_sha512",
                "scram",
                "scrypt",
                "apr_md5_crypt",
                "cta_pbkdf2_sha1",
                "dlitz_pbkdf2_sha1",
                "mssql2000",
                "mssql2005",
                "mysql141",
                "postgres_md5",
                "oracle11",
                "bsd_nthash",
                "django_pbkdf2_sha1",
                "django_pbkdf2_sha256",
                "django_salted_sha1",
                "django_salted_md5",
                "django_des_crypt",
                "grub_pbkdf2_sha512"
            ]
        },
        "error_text": {
            "enum": [
                "js_error",
                "py_error",
                "java_error",
                "rust_error",
                "ruby_error",
                "go_error",
                "php_error",
                "mysql_error",
                "postgres_error",
                "redis_error",
                "mongodb_error",
                "type_error",
                "uncaught",
                "socket_error",
                "operation_not_supported",
                "callback",
                "segfault",
                "runtime_error",
                "out_of_memory",
                "permission_denied",
                "command_not_found",
                "js_unknown_argument",
                "js_invalid_invocation",
                "js_bug_message",
                "envoy_segfault"
            ]
        },
        "exploit_detection": {
            "type": "object",
            "properties": {
                "hashes": {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/hash_type"
                    }
                },
                "error_text": {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/error_text"
                    }
                },
                "measure_entropy": {
                    "type": "boolean"
                },
                "detect_non_ascii": {
                    "type": "boolean"
                }
            },
            "unevaluatedProperties": false,
            "additionalProperties": false
        },
        "service_name_source": {
            "oneOf": [
                {
                    "enum": [
                        "none",
                        "istio"
                    ]
                },
                {
                    "type": "object",
                    "properties": {
                        "env": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "env"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "attrs": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "attrs"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "raw": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "raw"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "default": {
                            "type": "object",
                            "properties": {
                                "from": {
                                    "$ref": "#/$defs/service_name_source"
                                },
                                "to": {
                                    "$ref": "#/$defs/service_name_source"
                                }
                            },
                            "required": [
                                "from",
                                "to"
                            ],
                            "unevaluatedProperties": false,
                            "additionalProperties": false
                        }
                    },
                    "required": [
                        "default"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                }
            ],
            "unevaluatedProperties": false
        },
        "service_name_extractor": {
            "type": "object",
            "properties": {
                "cluster": {
                    "$ref": "#/$defs/service_name_source"
                },
                "ns": {
                    "$ref": "#/$defs/service_name_source"
                },
                "sa": {
                    "$ref": "#/$defs/service_name_source"
                },
                "workload": {
                    "$ref": "#/$defs/service_name_source"
                }
            },
            "required": [],
            "unevaluatedProperties": false,
            "additionalProperties": false
        },
        "rule_by": {
            "oneOf": [
                {
                    "enum": [
                        "ip",
                        "token",
                        "outbound_service",
                        "inbound_service"
                    ]
                },
                {
                    "type": "object",
                    "properties": {
                        "header": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "header"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                }
            ],
            "unevaluatedProperties": false
        },
        "match_item": {
            "oneOf": [
                {
                    "$ref": "#/$defs/service_rule"
                },
                {
                    "type": "object",
                    "properties": {
                        "correlate": {
                            "type": "object",
                            "properties": {
                                "interest": {
                                    "enum": [
                                        "primary",
                                        "secondary",
                                        "all"
                                    ]
                                },
                                "max_distance": {
                                    "type": "integer"
                                },
                                "matches": {
                                    "anyOf": [
                                        {
                                            "$ref": "#/$defs/category"
                                        },
                                        {
                                            "type": "string"
                                        }
                                    ]
                                }
                            },
                            "required": [
                                "max_distance",
                                "matches"
                            ]
                        }
                    },
                    "required": [
                        "correlate"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                }
            ],
            "unevaluatedProperties": false
        },
        "match_filter_rule": {
            "oneOf": [
                {
                    "type": "integer"
                },
                {
                    "type": "string"
                },
                {
                    "type": "array",
                    "items": {
                        "anyOf": [
                            {
                                "type": "object",
                                "properties": {
                                    "path": {
                                        "anyOf": [
                                            {
                                                "type": "string"
                                            },
                                            {
                                                "type": "array",
                                                "items": {
                                                    "type": "string"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "type": "object",
                                "properties": {
                                    "exclude_path": {
                                        "anyOf": [
                                            {
                                                "type": "string"
                                            },
                                            {
                                                "type": "array",
                                                "items": {
                                                    "type": "string"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "type": "object",
                                "properties": {
                                    "count": {
                                        "type": "integer"
                                    }
                                }
                            },
                            {
                                "type": "object",
                                "properties": {
                                    "value": {
                                        "anyOf": [
                                            {
                                                "$ref": "#/$defs/rule_filter"
                                            },
                                            {
                                                "type": "array",
                                                "items": {
                                                    "$ref": "#/$defs/rule_filter"
                                                }
                                            }
                                        ]
                                    }
                                }
                            },
                            {
                                "type": "object",
                                "properties": {
                                    "any": {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/match_filter_rule"
                                        }
                                    }
                                }
                            },
                            {
                                "type": "object",
                                "properties": {
                                    "all": {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/match_filter_rule"
                                        }
                                    }
                                }
                            }
                        ]
                    }
                }
            ]
        },
        "service_rule": {
            "oneOf": [
                {
                    "type": "object",
                    "properties": {
                        "raw": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "raw"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "raw_insensitive": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "raw_insensitive"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "regex": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "regex"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "except_regex": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "except_regex"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "except": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "except"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "except_insensitive": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "except_insensitive"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "internal": {
                            "oneOf": [
                                {
                                    "enum": [
                                        "routing_number",
                                        "credit_card",
                                        "int_phone",
                                        "hash",
                                        "error_text",
                                        "sql"
                                    ]
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "national_phone": {
                                            "type": "string"
                                        }
                                    },
                                    "required": [
                                        "national_phone"
                                    ],
                                    "unevaluatedProperties": false,
                                    "additionalProperties": false
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "hash": {
                                            "oneOf": [
                                                {
                                                    "$ref": "#/$defs/hash_type"
                                                },
                                                {
                                                    "type": "array",
                                                    "items": {
                                                        "$ref": "#/$defs/hash_type"
                                                    }
                                                }
                                            ]
                                        }
                                    },
                                    "required": [
                                        "hash"
                                    ],
                                    "unevaluatedProperties": false,
                                    "additionalProperties": false
                                },
                                {
                                    "type": "object",
                                    "properties": {
                                        "error_text": {
                                            "oneOf": [
                                                {
                                                    "$ref": "#/$defs/error_text"
                                                },
                                                {
                                                    "type": "array",
                                                    "items": {
                                                        "$ref": "#/$defs/error_text"
                                                    }
                                                }
                                            ]
                                        }
                                    },
                                    "required": [
                                        "error_text"
                                    ],
                                    "unevaluatedProperties": false,
                                    "additionalProperties": false
                                }
                            ]
                        }
                    },
                    "required": [
                        "internal"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "and": {
                            "$ref": "#/$defs/matches"
                        }
                    },
                    "required": [
                        "and"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "string"
                }
            ]
        },
        "service_filter": {
            "anyOf": [
                {
                    "type": "object",
                    "properties": {
                        "cluster": {
                            "anyOf": [
                                {
                                    "$ref": "#/$defs/service_rule"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/$defs/service_rule"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "cluster"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_cluster": {
                            "anyOf": [
                                {
                                    "$ref": "#/$defs/service_rule"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/$defs/service_rule"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "exclude_cluster"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "ns": {
                            "anyOf": [
                                {
                                    "$ref": "#/$defs/service_rule"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/$defs/service_rule"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "ns"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_ns": {
                            "anyOf": [
                                {
                                    "$ref": "#/$defs/service_rule"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/$defs/service_rule"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "exclude_ns"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "sa": {
                            "anyOf": [
                                {
                                    "$ref": "#/$defs/service_rule"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/$defs/service_rule"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "sa"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_sa": {
                            "anyOf": [
                                {
                                    "$ref": "#/$defs/service_rule"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/$defs/service_rule"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "exclude_sa"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "workload": {
                            "anyOf": [
                                {
                                    "$ref": "#/$defs/service_rule"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/$defs/service_rule"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "workload"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_workload": {
                            "anyOf": [
                                {
                                    "$ref": "#/$defs/service_rule"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/$defs/service_rule"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "exclude_workload"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "enum": [
                        "response_outbound",
                        "response_inbound"
                    ]
                },
                {
                    "type": "object",
                    "properties": {
                        "any": {
                            "type": "array",
                            "items": {
                                "$ref": "#/$defs/rule_filter"
                            }
                        }
                    },
                    "required": [
                        "any"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "all": {
                            "type": "array",
                            "items": {
                                "$ref": "#/$defs/rule_filter"
                            }
                        }
                    },
                    "required": [
                        "all"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                }
            ],
            "unevaluatedProperties": false
        },
        "category": {
            "oneOf": [
                {
                    "$ref": "#/$defs/matches"
                },
                {
                    "type": "object",
                    "items": {
                        "matchers": {
                            "$ref": "#/$defs/matches"
                        },
                        "tag": {
                            "type": "string"
                        }
                    }
                }
            ]
        },
        "matches": {
            "anyOf": [
                {
                    "$ref": "#/$defs/match_item"
                },
                {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/match_item"
                    }
                }
            ]
        },
        "report_style": {
            "enum": [
                "raw",
                "partial_sha256",
                "sha256",
                "none"
            ]
        },
        "content_type": {
            "enum": [
                "text",
                "json",
                "grpc",
                "filebeat",
                "tls",
                "none"
            ]
        },
        "match_context": {
            "anyOf": [
                {
                    "enum": [
                        "keys",
                        "values",
                        "values_key"
                    ]
                },
                {
                    "type": "object",
                    "properties": {
                        "header": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "header"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                }
            ]
        },
        "token_extractor": {
            "anyOf": [
                {
                    "type": "object",
                    "properties": {
                        "regex": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "regex"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "enum": [
                        "jwt_decode",
                        "hash"
                    ]
                },
                {
                    "type": "object",
                    "properties": {
                        "json_path": {
                            "type": "string"
                        }
                    },
                    "required": [
                        "json_path"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "metadata": {
                        "type": "object",
                        "additionalProperties": {
                            "type": {
                                "anyOf": [
                                    {
                                        "type": "#/$defs/token_extractor"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "type": "#/$defs/token_extractor"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "required": [
                        "metadata"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                }
            ]
        },
        "body_extractor": {
            "type": "object",
            "additionalProperties": {
                "type": {
                    "anyOf": [
                        {
                            "type": "string"
                        },
                        {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        }
                    ]
                }
            },
            "required": [
                "metadata"
            ],
            "unevaluatedProperties": false
        },
        "endpoints": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "matches": {
                        "$ref": "#/$defs/rule_filter"
                    },
                    "search": {
                        "enum": [
                            "request_body",
                            "downstream",
                            "request_header",
                            "response_body",
                            "upstream",
                            "response_header",
                            "all_body",
                            "all_header",
                            "all"
                        ]
                    },
                    "token_extractor": {
                        "type": "object",
                        "properties": {
                            "location": {
                                "enum": [
                                    "request",
                                    "request_cookie",
                                    "response"
                                ]
                            },
                            "header": {
                                "type": "string"
                            },
                            "extractor": {
                                "anyOf": [
                                    {
                                        "$ref": "#/$defs/token_extractor"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/token_extractor"
                                        }
                                    }
                                ]
                            }
                        },
                        "required": [
                            "location",
                            "header"
                        ],
                        "unevaluatedProperties": false
                    },
                    "report_style": {
                        "$ref": "#/$defs/report_style"
                    },
                    "report_bits": {
                        "type": "integer"
                    },
                    "exploit_detection": {
                        "$ref": "#/$defs/exploit_detection"
                    },
                    "config": {
                        "type": "object",
                        "additionalProperties": {
                            "type": "object",
                            "properties": {
                                "name": {
                                    "type": "string"
                                },
                                "matcher": {
                                    "type": "string"
                                },
                                "action": {
                                    "oneOf": [
                                        {
                                            "enum": [
                                                "ignore",
                                                "alert",
                                                "block"
                                            ]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "redact": {
                                                    "type": "string"
                                                }
                                            },
                                            "required": [
                                                "redact"
                                            ],
                                            "unevaluatedProperties": false,
                                            "additionalProperties": false
                                        }
                                    ]
                                },
                                "content_types": {
                                    "anyOf": [
                                        {
                                            "$ref": "#/$defs/content_type"
                                        },
                                        {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/$defs/content_type"
                                            }
                                        }
                                    ]
                                },
                                "contexts": {
                                    "anyOf": [
                                        {
                                            "$ref": "#/$defs/match_context"
                                        },
                                        {
                                            "type": "array",
                                            "items": {
                                                "$ref": "#/$defs/match_context"
                                            }
                                        }
                                    ]
                                },
                                "search": {
                                    "enum": [
                                        "request_body",
                                        "request_header",
                                        "response_body",
                                        "response_header",
                                        "all_body",
                                        "all_header",
                                        "all"
                                    ]
                                },
                                "ignore": {
                                    "type": "array",
                                    "items": {
                                        "type": "string"
                                    }
                                },
                                "report_style": {
                                    "$ref": "#/$defs/report_style"
                                },
                                "report_bits": {
                                    "type": "integer"
                                }
                            },
                            "unevaluatedProperties": false
                        }
                    },
                    "request_extractors": {
                        "$ref": "#/$defs/body_extractor"
                    },
                    "response_extractors": {
                        "$ref": "#/$defs/body_extractor"
                    }
                },
                "required": [
                    "matches"
                ],
                "unevaluatedProperties": false,
                "additionalProperties": false
            }
        },
        "rule_filter": {
            "anyOf": [
                {
                    "type": "object",
                    "properties": {
                        "endpoint": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "type": "string"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "endpoint"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_endpoint": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "type": "string"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "exclude_endpoint"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "policy_path": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "type": "string"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "policy_path"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_policy_path": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "type": "string"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "exclude_policy_path"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "peer_service": {
                            "$ref": "#/$defs/service_filter"
                        }
                    },
                    "required": [
                        "peer_service"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_peer_service": {
                            "$ref": "#/$defs/service_filter"
                        }
                    },
                    "required": [
                        "exclude_peer_service"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "local_service": {
                            "$ref": "#/$defs/service_filter"
                        }
                    },
                    "required": [
                        "local_service"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_local_service": {
                            "$ref": "#/$defs/service_filter"
                        }
                    },
                    "required": [
                        "exclude_local_service"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "token": {
                            "anyOf": [
                                {
                                    "$ref": "#/$defs/service_rule"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/$defs/service_rule"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "token"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_token": {
                            "anyOf": [
                                {
                                    "$ref": "#/$defs/service_rule"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/$defs/service_rule"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "exclude_token"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "ip": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "type": "string"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "ip"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_ip": {
                            "anyOf": [
                                {
                                    "type": "string"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "type": "string"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "exclude_ip"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "request_matches": {
                            "type": "object",
                            "additionalProperties": {
                                "anyOf": [
                                    {
                                        "$ref": "#/$defs/match_filter_rule"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/match_filter_rule"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "required": [
                        "request_matches"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "response_matches": {
                            "type": "object",
                            "additionalProperties": {
                                "anyOf": [
                                    {
                                        "$ref": "#/$defs/match_filter_rule"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/match_filter_rule"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "required": [
                        "response_matches"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "upstream_matches": {
                            "type": "object",
                            "additionalProperties": {
                                "anyOf": [
                                    {
                                        "$ref": "#/$defs/match_filter_rule"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/match_filter_rule"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "required": [
                        "upstream_matches"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "downstream_matches": {
                            "type": "object",
                            "additionalProperties": {
                                "anyOf": [
                                    {
                                        "$ref": "#/$defs/match_filter_rule"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/match_filter_rule"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "required": [
                        "downstream_matches"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "request_headers": {
                            "type": "object",
                            "additionalProperties": {
                                "anyOf": [
                                    {
                                        "$ref": "#/$defs/service_rule"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/service_rule"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "required": [
                        "request_headers"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_request_headers": {
                            "type": "object",
                            "additionalProperties": {
                                "anyOf": [
                                    {
                                        "$ref": "#/$defs/service_rule"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/service_rule"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "required": [
                        "exclude_request_headers"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "response_headers": {
                            "type": "object",
                            "additionalProperties": {
                                "anyOf": [
                                    {
                                        "$ref": "#/$defs/service_rule"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/service_rule"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "required": [
                        "response_headers"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_response_headers": {
                            "type": "object",
                            "additionalProperties": {
                                "anyOf": [
                                    {
                                        "$ref": "#/$defs/service_rule"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/service_rule"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "required": [
                        "exclude_response_headers"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "response_trailers": {
                            "type": "object",
                            "additionalProperties": {
                                "anyOf": [
                                    {
                                        "$ref": "#/$defs/service_rule"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/service_rule"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "required": [
                        "response_trailers"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_response_trailers": {
                            "type": "object",
                            "additionalProperties": {
                                "anyOf": [
                                    {
                                        "$ref": "#/$defs/service_rule"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/service_rule"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "required": [
                        "exclude_response_trailers"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "request_cookie": {
                            "type": "object",
                            "additionalProperties": {
                                "anyOf": [
                                    {
                                        "$ref": "#/$defs/service_rule"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/service_rule"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "required": [
                        "request_cookie"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "exclude_request_cookie": {
                            "type": "object",
                            "additionalProperties": {
                                "anyOf": [
                                    {
                                        "$ref": "#/$defs/service_rule"
                                    },
                                    {
                                        "type": "array",
                                        "items": {
                                            "$ref": "#/$defs/service_rule"
                                        }
                                    }
                                ]
                            }
                        }
                    },
                    "required": [
                        "exclude_request_cookie"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "enum": [
                        "response_outbound",
                        "response_inbound"
                    ]
                },
                {
                    "type": "object",
                    "properties": {
                        "any": {
                            "type": "array",
                            "items": {
                                "$ref": "#/$defs/rule_filter"
                            }
                        }
                    },
                    "required": [
                        "any"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "all": {
                            "type": "array",
                            "items": {
                                "$ref": "#/$defs/rule_filter"
                            }
                        }
                    },
                    "required": [
                        "all"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                }
            ],
            "unevaluatedProperties": false
        },
        "stage": {
            "type": "string",
            "enum": [
                "pre_request_headers",
                "on_request_header_chunk",
                "post_request_headers",
                "on_request_body_chunk",
                "post_request_body",
                "on_response_header_chunk",
                "post_response_headers",
                "on_response_body_chunk",
                "post_response_body",
                "on_response_trailer_chunk",
                "post_response_trailers"
            ]
        },
        "sbac_item": {
            "type": "object",
            "properties": {
                "name": {
                    "type": [
                        "string",
                        "null"
                    ]
                },
                "stage": {
                    "$ref": "#/$defs/stage"
                },
                "filter": {
                    "$ref": "#/$defs/rule_filter"
                }
            },
            "required": [
                "filter"
            ],
            "unevaluatedProperties": false,
            "additionalProperties": false
        },
        "header_collection_mode": {
            "type": "string",
            "enum": [
                "all_request",
                "all_response",
                "all",
                "none"
            ]
        },
        "stream_upload_interval": {
            "oneOf": [
                {
                    "type": "object",
                    "properties": {
                        "frames": {
                            "type": "integer"
                        }
                    },
                    "required": [
                        "frames"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "matches": {
                            "type": "integer"
                        }
                    },
                    "required": [
                        "matches"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "time": {
                            "type": "integer"
                        }
                    },
                    "required": [
                        "time"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "all": {
                            "type": "#/$defs/stream_upload_interval"
                        }
                    },
                    "required": [
                        "all"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "any": {
                            "type": "#/$defs/stream_upload_interval"
                        }
                    },
                    "required": [
                        "any"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "all": {
                            "type": "#/$defs/stream_upload_interval"
                        }
                    },
                    "required": [
                        "all"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "enum": [
                        "none"
                    ]
                }
            ]
        },
        "stream_port_filter": {
            "oneOf": [
                {
                    "type": "object",
                    "properties": {
                        "src": {
                            "$ref": "#/$defs/stream_port_filter"
                        }
                    },
                    "required": [
                        "src"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "dest": {
                            "$ref": "#/$defs/stream_port_filter"
                        }
                    },
                    "required": [
                        "dest"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "port": {
                            "type": "integer"
                        }
                    },
                    "required": [
                        "port"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "range": {
                            "type": "object",
                            "properties": {
                                "start": {
                                    "type": "integer"
                                },
                                "end": {
                                    "type": "integer"
                                }
                            },
                            "required": [
                                "start",
                                "end"
                            ],
                            "unevaluatedProperties": false,
                            "additionalProperties": false
                        }
                    },
                    "required": [
                        "range"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "any": {
                            "type": "array",
                            "items": {
                                "$ref": "#/$defs/stream_port_filter"
                            }
                        }
                    },
                    "required": [
                        "any"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "all": {
                            "type": "array",
                            "items": {
                                "$ref": "#/$defs/stream_port_filter"
                            }
                        }
                    },
                    "required": [
                        "all"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "type": "object",
                    "properties": {
                        "not": {
                            "oneOf": [
                                {
                                    "$ref": "#/$defs/stream_port_filter"
                                },
                                {
                                    "type": "array",
                                    "items": {
                                        "$ref": "#/$defs/stream_port_filter"
                                    }
                                }
                            ]
                        }
                    },
                    "required": [
                        "not"
                    ],
                    "unevaluatedProperties": false,
                    "additionalProperties": false
                },
                {
                    "enum": [
                        "always",
                        "never"
                    ]
                }
            ]
        }
    },
    "properties": {
        "categories": {
            "$ref": "#/$defs/category"
        },
        "endpoints": {
            "$ref": "#/$defs/endpoints"
        },
        "filter": {
            "$ref": "#/$defs/service_filter"
        },
        "sbac": {
            "anyOf": [
                {
                    "$ref": "#/$defs/sbac_item"
                },
                {
                    "type": "array",
                    "items": {
                        "$ref": "#/$defs/sbac_item"
                    }
                }
            ]
        },
        "collected_request_headers": {
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "collected_response_headers": {
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "body_collection": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "mode": {
                        "enum": [
                            "request_only",
                            "upstream_only",
                            "response_only",
                            "downstream_only",
                            "all"
                        ]
                    },
                    "sample_rate": {
                        "type": "number"
                    },
                    "max_body_collection_mb": {
                        "type": "number"
                    },
                    "filter": {
                        "$ref": "#/$defs/rule_filter"
                    }
                },
                "required": [
                    "sample_rate"
                ],
                "unevaluatedProperties": false,
                "additionalProperties": false
            }
        },
        "header_collection": {
            "$ref": "#/$defs/header_collection_mode"
        },
        "report_style": {
            "$ref": "#/$defs/report_style"
        },
        "report_bits": {
            "type": "integer"
        },
        "blocked_ips": {
            "type": "string"
        },
        "blocked_tokens": {
            "type": "string"
        },
        "rules": {
            "type": "array",
            "items": {
                "type": "object",
                "properties": {
                    "name": {
                        "type": "string"
                    },
                    "grouping": {
                        "enum": [
                            "global",
                            "per_inbound_service",
                            "per_outbound_service",
                            "per_endpoint"
                        ]
                    },
                    "by": {
                        "$ref": "#/$defs/rule_by"
                    },
                    "count_by": {
                        "$ref": "#/$defs/rule_by"
                    },
                    "action": {
                        "enum": [
                            "nothing",
                            "alert",
                            "block",
                            "alert_block"
                        ]
                    },
                    "timespan_secs": {
                        "type": "integer"
                    },
                    "limit": {
                        "type": "integer"
                    },
                    "filter": {
                        "$ref": "#/$defs/rule_filter"
                    },
                    "severity": {
                        "enum": [
                            "routine",
                            "notable",
                            "concern",
                            "immediate"
                        ]
                    },
                    "muted": {
                        "type": "boolean"
                    }
                },
                "required": [
                    "by",
                    "limit"
                ],
                "unevaluatedProperties": false,
                "additionalProperties": false
            }
        },
        "content_types": {
            "type": "object",
            "additionalProperties": {
                "$ref": "#/$defs/content_type"
            }
        },
        "stream_types": {
            "type": "object",
            "additionalProperties": {
                "$ref": "#/$defs/stream_port_filter"
            }
        },
        "local_service_name": {
            "$ref": "#/$defs/service_name_extractor"
        },
        "peer_service_name": {
            "$ref": "#/$defs/service_name_extractor"
        },
        "path_groups": {
            "oneOf": [
                {
                    "type": "string"
                },
                {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                }
            ]
        }
    },
    "required": [
        "categories"
    ],
    "unevaluatedProperties": false,
    "additionalProperties": false,
    "stream_upload_interval": {
        "$ref": "#/$defs/stream_upload_interval"
    }
}